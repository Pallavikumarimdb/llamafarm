$schema: http://json-schema.org/draft-07/schema#
$id: https://github.com/llama-farm/llamafarm/rag/schema.yaml
title: RAG Strategy Configuration Schema
description: Schema for RAG system strategy configurations
type: object
additionalProperties: false
properties:
  strategies:
    type: array
    title: Strategy Definitions
    description: Array of strategy configurations
    minItems: 1
    items:
      $ref: "#/definitions/strategyDefinition"
  strategy_templates:
    type: object
    title: Predefined Strategy Templates
    description: Ready-to-use strategy configurations
    default: {}
    additionalProperties:
      $ref: "#/definitions/strategyDefinition"
  component_metadata:
    type: object
    title: Component Metadata
    description: Metadata about available components
    properties:
      parsers:
        type: object
        additionalProperties:
          type: object
          properties:
            description:
              type: string
            class_name:
              type: string
            module:
              type: string
            use_cases:
              type: array
              items:
                type: string
            dependencies:
              type: object
              properties:
                required:
                  type: array
                  items:
                    type: string
                optional:
                  type: array
                  items:
                    type: string
      extractors:
        type: object
        additionalProperties:
          type: object
      embedders:
        type: object
        additionalProperties:
          type: object
      vector_stores:
        type: object
        additionalProperties:
          type: object
      retrieval_strategies:
        type: object
        additionalProperties:
          type: object
  compatibility_rules:
    type: object
    title: Component Compatibility Rules
    description: Rules for component compatibility
    properties:
      component_compatibility:
        type: object
      embedder_store_compatibility:
        type: object
      strategy_store_optimization:
        type: object
  validation_rules:
    type: object
    title: Validation Rules
    description: System-wide validation rules
    properties:
      required_fields:
        type: object
      field_constraints:
        type: object
      performance_warnings:
        type: array
        items:
          type: object
  best_practices:
    type: object
    title: Best Practices
    description: Recommended configuration patterns
    additionalProperties:
      type: array
      items:
        type: string
required:
  - strategies
definitions:
  strategyDefinition:
    type: object
    title: Strategy Definition
    description: Defines a complete RAG strategy configuration
    required:
      - name
      - description
      - components
    additionalProperties: false
    properties:
      name:
        type: string
        pattern: ^[a-z][a-z0-9_]*$
        minLength: 1
        maxLength: 50
        description: Unique strategy identifier
        examples:
          - simple
          - customer_support
          - legal_documents
      description:
        type: string
        minLength: 10
        maxLength: 500
        description: Clear description of strategy purpose
      tags:
        type: array
        uniqueItems: true
        items:
          type: string
          pattern: ^[a-z0-9_-]+$
        description: Tags for categorization
        examples:
          - - production
            - optimized
          - - development
            - testing
      use_cases:
        type: array
        minItems: 1
        uniqueItems: true
        items:
          type: string
          minLength: 3
        description: Specific use cases
      components:
        $ref: "#/definitions/strategyComponents"
      optimization:
        type: object
        title: Optimization Settings
        description: Performance and resource optimization settings
        additionalProperties: true
      validation:
        type: object
        title: Validation Rules
        description: Data validation and quality rules
        additionalProperties: true
      monitoring:
        type: object
        title: Monitoring Configuration
        description: Monitoring and metrics settings
        additionalProperties: true
  strategyComponents:
    type: object
    title: Strategy Components
    required:
      - parser
      - embedder
      - vector_store
      - retrieval_strategy
    additionalProperties: false
    properties:
      parser:
        $ref: "#/definitions/parserConfig"
      extractors:
        type: array
        maxItems: 10
        items:
          $ref: "#/definitions/extractorConfig"
      embedder:
        $ref: "#/definitions/embedderConfig"
      vector_store:
        $ref: "#/definitions/vectorStoreConfig"
      retrieval_strategy:
        $ref: "#/definitions/retrievalStrategyConfig"
  parserConfig:
    title: Parser Configuration
    description: Parser configuration
    required: [type, config]
    additionalProperties: false
    properties:
      type:
        type: string
        enum:
          - DirectoryParser
          - CSVParser
          - PDFParser
          - MarkdownParser
          - HTMLParser
          - DocxParser
          - ExcelParser
          - PlainTextParser
      config:
        type: object
        oneOf:
          - $ref: "#/definitions/parsers/directoryParserConfig"
          - $ref: "#/definitions/parsers/csvParserConfig"
          - $ref: "#/definitions/parsers/pdfParserConfig"
          - $ref: "#/definitions/parsers/markdownParserConfig"
          - $ref: "#/definitions/parsers/htmlParserConfig"
          - $ref: "#/definitions/parsers/docxParserConfig"
          - $ref: "#/definitions/parsers/excelParserConfig"
          - $ref: "#/definitions/parsers/plainTextParserConfig"
  parsers:
    directoryParserConfig:
      type: object
      title: Directory Parser Configuration
      additionalProperties: false
      properties:
        recursive:
          type: boolean
          default: true
          description: Recursively parse subdirectories
        include_patterns:
          type: array
          items:
            type: string
          description: File patterns to include
        exclude_patterns:
          type: array
          items:
            type: string
          description: File patterns to exclude
        parser_map:
          type: object
          additionalProperties:
            type: string
          description: Mapping of file extensions to parser types
        parser_configs:
          type: object
          additionalProperties:
            type: object
          description: Configuration for each parser type
    csvParserConfig:
      type: object
      title: CSV Parser Configuration
      additionalProperties: false
      properties:
        content_fields:
          type: array
          items:
            type: string
          default:
            - subject
            - body
          description: CSV columns to use as document content
          minItems: 1
        metadata_fields:
          type: array
          items:
            type: string
          default: []
          description: CSV columns to include as metadata
        id_field:
          type: ["string", "null"]
          default: null
          description: CSV column to use as document ID
        combine_content:
          type: boolean
          default: true
          description: Combine multiple content fields into one document
        content_separator:
          type: string
          default: "\n\n"
          description: Separator when combining content fields
        priority_mapping:
          type: object
          description: Mapping for priority field values
          additionalProperties:
            type: ["string", "number"]
          example:
            "Critical": 1
            "High": 2
            "Medium": 3
            "Low": 4
    pdfParserConfig:
      type: object
      title: PDF Parser Configuration
      additionalProperties: false
      properties:
        extract_metadata:
          type: boolean
          default: true
          description: Extract PDF metadata
        extract_page_structure:
          type: boolean
          default: true
          description: Extract page-level structure
        combine_pages:
          type: boolean
          default: true
          description: Combine all pages into single document
        page_separator:
          type: string
          default: "


            --- Page Break ---


            "
          description: Separator between pages
        min_text_length:
          type: integer
          default: 10
          minimum: 0
          description: Minimum text length to include page
        include_page_numbers:
          type: boolean
          default: true
          description: Include page numbers in text
        extract_outline:
          type: boolean
          default: true
          description: Extract document outline
        extract_images:
          type: boolean
          default: false
          description: Extract embedded images
        ocr_enabled:
          type: boolean
          default: false
          description: Enable OCR for scanned documents

        # Chunking configuration
        chunk_size:
          type: [integer, "null"]
          default: null
          minimum: 100
          maximum: 50000
          description: "Chunk size in characters (null for no chunking)"
        chunk_overlap:
          type: integer
          default: 0
          minimum: 0
          maximum: 5000
          description: "Overlap between chunks in characters"
        chunk_strategy:
          type: string
          enum:
            - characters
            - sentences
            - paragraphs
            - pages
          default: characters
          description: "Chunking strategy - pages splits at PDF page boundaries"
        respect_sentence_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting sentences in the middle when using character chunking"
        respect_paragraph_boundaries:
          type: boolean
          default: false
          description: "Avoid splitting paragraphs in the middle (overrides sentence boundaries)"
        min_chunk_size:
          type: integer
          default: 50
          minimum: 10
          maximum: 1000
          description: "Minimum chunk size to avoid creating tiny chunks"
    markdownParserConfig:
      type: object
      title: Markdown Parser Configuration
      additionalProperties: false
      properties:
        extract_metadata:
          type: boolean
          default: true
          description: Extract YAML frontmatter
        extract_headings:
          type: boolean
          default: true
          description: Extract heading structure
        extract_links:
          type: boolean
          default: true
          description: Extract all links
        extract_code_blocks:
          type: boolean
          default: true
          description: Extract code blocks
        chunk_by_headings:
          type: boolean
          default: false
          description: Split by headings
        preserve_formatting:
          type: boolean
          default: false
          description: Preserve Markdown formatting
        heading_level_split:
          type: integer
          default: 2
          minimum: 1
          maximum: 6
          description: Heading level for splitting

        # Advanced chunking configuration
        chunk_size:
          type: [integer, "null"]
          default: null
          minimum: 100
          maximum: 50000
          description: "Chunk size in characters (null for no chunking, overrides chunk_by_headings)"
        chunk_overlap:
          type: integer
          default: 0
          minimum: 0
          maximum: 5000
          description: "Overlap between chunks in characters"
        chunk_strategy:
          type: string
          enum:
            - characters
            - sentences
            - paragraphs
            - headings
          default: headings
          description: "Chunking strategy - headings preserves markdown structure"
        respect_sentence_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting sentences in the middle when using character chunking"
        respect_paragraph_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting paragraphs in the middle"
        min_chunk_size:
          type: integer
          default: 100
          minimum: 10
          maximum: 1000
          description: "Minimum chunk size to avoid creating tiny chunks"
    htmlParserConfig:
      type: object
      title: HTML Parser Configuration
      additionalProperties: false
      properties:
        extract_metadata:
          type: boolean
          default: true
          description: Extract meta tags
        extract_links:
          type: boolean
          default: true
          description: Extract hyperlinks
        extract_images:
          type: boolean
          default: true
          description: Extract image sources
        preserve_structure:
          type: boolean
          default: false
          description: Preserve HTML structure
        remove_scripts:
          type: boolean
          default: true
          description: Remove JavaScript
        remove_styles:
          type: boolean
          default: true
          description: Remove CSS
        text_only:
          type: boolean
          default: false
          description: Extract only text

        # Chunking configuration
        chunk_size:
          type: [integer, "null"]
          default: null
          minimum: 100
          maximum: 50000
          description: "Chunk size in characters (null for no chunking)"
        chunk_overlap:
          type: integer
          default: 0
          minimum: 0
          maximum: 5000
          description: "Overlap between chunks in characters"
        chunk_strategy:
          type: string
          enum:
            - characters
            - sentences
            - paragraphs
            - elements
          default: elements
          description: "Chunking strategy - elements uses HTML semantic structure"
        respect_sentence_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting sentences in the middle when using character chunking"
        respect_paragraph_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting paragraphs in the middle"
        min_chunk_size:
          type: integer
          default: 100
          minimum: 10
          maximum: 1000
          description: "Minimum chunk size to avoid creating tiny chunks"
    docxParserConfig:
      type: object
      title: DOCX Parser Configuration
      additionalProperties: false
      properties:
        extract_metadata:
          type: boolean
          default: true
          description: Extract document properties
        extract_headers_footers:
          type: boolean
          default: true
          description: Include headers and footers
        extract_comments:
          type: boolean
          default: true
          description: Extract comments
        extract_tables:
          type: boolean
          default: true
          description: Extract tables
        extract_images:
          type: boolean
          default: false
          description: Extract images
        preserve_formatting:
          type: boolean
          default: false
          description: Preserve text formatting

        # Chunking configuration
        chunk_size:
          type: [integer, "null"]
          default: null
          minimum: 100
          maximum: 50000
          description: "Chunk size in characters (null for no chunking)"
        chunk_overlap:
          type: integer
          default: 0
          minimum: 0
          maximum: 5000
          description: "Overlap between chunks in characters"
        chunk_strategy:
          type: string
          enum:
            - characters
            - sentences
            - paragraphs
            - sections
          default: paragraphs
          description: "Chunking strategy - sections uses Word's built-in structure"
        respect_sentence_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting sentences in the middle when using character chunking"
        respect_paragraph_boundaries:
          type: boolean
          default: true
          description: "Avoid splitting paragraphs in the middle"
        min_chunk_size:
          type: integer
          default: 100
          minimum: 10
          maximum: 1000
          description: "Minimum chunk size to avoid creating tiny chunks"
    excelParserConfig:
      type: object
      title: Excel Parser Configuration
      additionalProperties: false
      properties:
        sheet_names:
          type:
            - array
            - "null"
          items:
            type: string
          default: null
          description: Specific sheets to parse
        combine_sheets:
          type: boolean
          default: false
          description: Combine all sheets
        extract_formulas:
          type: boolean
          default: false
          description: Extract cell formulas
        extract_charts:
          type: boolean
          default: false
          description: Extract chart metadata
        table_format:
          type: string
          enum:
            - csv
            - markdown
            - json
            - text
          default: markdown
          description: Table output format
        header_row:
          type: integer
          default: 0
          minimum: 0
          description: Header row index
    plainTextParserConfig:
      type: object
      title: Plain Text Parser Configuration
      additionalProperties: false
      properties:
        encoding:
          type: string
          default: auto
          description: Text encoding (auto-detect or specify like utf-8, latin1, etc.)
        chunk_size:
          type: [integer, "null"]
          default: null
          minimum: 100
          maximum: 50000
          description: Chunk size in characters (null for no chunking)
        chunk_overlap:
          type: integer
          default: 0
          minimum: 0
          maximum: 5000
          description: Overlap between chunks in characters
        chunk_strategy:
          type: string
          enum:
            - characters
            - sentences
            - paragraphs
          default: characters
          description: Chunking strategy - how to split the text
        respect_sentence_boundaries:
          type: boolean
          default: true
          description: Avoid splitting sentences in the middle when using character chunking
        respect_paragraph_boundaries:
          type: boolean
          default: false
          description: Avoid splitting paragraphs in the middle (overrides sentence boundaries)
        min_chunk_size:
          type: integer
          default: 50
          minimum: 10
          maximum: 1000
          description: Minimum chunk size to avoid creating tiny chunks
        preserve_line_breaks:
          type: boolean
          default: true
          description: Preserve line breaks in the text
        strip_empty_lines:
          type: boolean
          default: true
          description: Remove empty lines while preserving paragraph structure
        detect_structure:
          type: boolean
          default: true
          description: Detect and extract structural elements (headers, lists, code blocks)
        split_by:
          type: string
          enum:
            - characters
            - words
            - sentences
            - paragraphs
            - lines
          default: characters
          description: Splitting method
        preserve_whitespace:
          type: boolean
          default: false
          description: Preserve whitespace
  extractorConfig:
    type: object
    title: Extractor Configuration
    additionalProperties: false
    required: [type, config]
    properties:
      type:
        type: string
        description: Extractor type identifier
        enum:
          - KeywordExtractor
          - EntityExtractor
          - DateTimeExtractor
          - HeadingExtractor
          - LinkExtractor
          - PathExtractor
          - PatternExtractor
          - StatisticsExtractor
          - SummaryExtractor
          - TableExtractor
          - SentimentExtractor
          - YAKEExtractor
          - ContentStatisticsExtractor
      priority:
        type: integer
        minimum: 1
        maximum: 1000
        description: Execution priority (higher numbers run first)
      config:
        type: object
        anyOf:
          - $ref: "#/definitions/extractors/keywordExtractorConfig"
          - $ref: "#/definitions/extractors/entityExtractorConfig"
          - $ref: "#/definitions/extractors/dateTimeExtractorConfig"
          - $ref: "#/definitions/extractors/headingExtractorConfig"
          - $ref: "#/definitions/extractors/linkExtractorConfig"
          - $ref: "#/definitions/extractors/pathExtractorConfig"
          - $ref: "#/definitions/extractors/patternExtractorConfig"
          - $ref: "#/definitions/extractors/statisticsExtractorConfig"
          - $ref: "#/definitions/extractors/summaryExtractorConfig"
          - $ref: "#/definitions/extractors/tableExtractorConfig"
          - $ref: "#/definitions/extractors/sentimentExtractorConfig"
          - $ref: "#/definitions/extractors/yakeExtractorConfig"
          - $ref: "#/definitions/extractors/contentStatisticsExtractorConfig"
  extractors:
    keywordExtractorConfig:
      type: object
      title: Keyword Extractor Configuration
      additionalProperties: false
      properties:
        extractor_type:
          type: string
          const: keyword
          description: Extractor type discriminator
        algorithm:
          type: string
          enum:
            - rake
            - yake
            - tfidf
            - textrank
          default: rake
          description: Extraction algorithm
        max_keywords:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
          description: Maximum keywords to extract
        min_length:
          type: integer
          default: 1
          minimum: 1
          description: Minimum word length for keywords
        max_length:
          type: integer
          default: 4
          minimum: 1
          description: Maximum word length for keywords
        min_frequency:
          type: integer
          default: 1
          minimum: 1
          description: Minimum frequency for keywords
        stop_words:
          type: array
          items:
            type: string
          description: Custom stop words
        language:
          type: string
          default: en
          description: Language for YAKE algorithm
        max_ngram_size:
          type: integer
          default: 3
          minimum: 1
          maximum: 5
          description: Maximum n-gram size for YAKE
        deduplication_threshold:
          type: number
          default: 0.9
          minimum: 0.0
          maximum: 1.0
          description: Deduplication threshold for YAKE
    entityExtractorConfig:
      type: object
      title: Entity Extractor Configuration
      additionalProperties: false
      properties:
        model:
          type: string
          default: en_core_web_sm
          description: NER model name
        entity_types:
          type: array
          items:
            type: string
            enum:
              - PERSON
              - ORG
              - GPE
              - DATE
              - TIME
              - MONEY
              - EMAIL
              - PHONE
              - URL
              - LAW
              - PERCENT
              - PRODUCT
              - EVENT
              - VERSION
              - FAC
              - LOC
          default:
            - PERSON
            - ORG
            - GPE
            - DATE
            - TIME
            - MONEY
            - EMAIL
            - PHONE
            - URL
            - PERCENT
            - PRODUCT
            - EVENT
          description: Entity types to extract
        use_fallback:
          type: boolean
          default: true
          description: Use regex fallback
        min_entity_length:
          type: integer
          default: 2
          minimum: 1
          description: Minimum entity length
        merge_entities:
          type: boolean
          default: true
          description: Merge adjacent entities
        confidence_threshold:
          type: number
          default: 0.7
          minimum: 0.0
          maximum: 1.0
          description: Minimum confidence score
    dateTimeExtractorConfig:
      type: object
      title: DateTime Extractor Configuration
      additionalProperties: false
      properties:
        fuzzy_parsing:
          type: boolean
          default: true
          description: Enable fuzzy parsing
        extract_relative:
          type: boolean
          default: true
          description: Extract relative dates
        extract_times:
          type: boolean
          default: true
          description: Extract time expressions
        extract_durations:
          type: boolean
          default: true
          description: Extract durations
        default_timezone:
          type: string
          default: UTC
          description: Default timezone
        date_format:
          type: string
          default: ISO
          description: Output date format
        prefer_dates_from:
          type: string
          enum:
            - past
            - future
            - current
          default: current
          description: Preference for ambiguous dates
    headingExtractorConfig:
      type: object
      title: Heading Extractor Configuration
      additionalProperties: false
      properties:
        max_level:
          type: integer
          default: 6
          minimum: 1
          maximum: 6
          description: Maximum heading level
        include_hierarchy:
          type: boolean
          default: true
          description: Include hierarchy structure
        extract_outline:
          type: boolean
          default: true
          description: Generate document outline
        min_heading_length:
          type: integer
          default: 3
          minimum: 1
          description: Minimum heading length
        enabled:
          type: boolean
          default: true
          description: Enable this extractor
    linkExtractorConfig:
      type: object
      title: Link Extractor Configuration
      additionalProperties: false
      properties:
        extract_urls:
          type: boolean
          default: true
          description: Extract URLs
        extract_emails:
          type: boolean
          default: true
          description: Extract email addresses
        extract_domains:
          type: boolean
          default: true
          description: Extract unique domains
        validate_urls:
          type: boolean
          default: false
          description: Validate URL format
        resolve_redirects:
          type: boolean
          default: false
          description: Resolve URL redirects
        enabled:
          type: boolean
          default: true
          description: Enable this extractor
    pathExtractorConfig:
      type: object
      title: Path Extractor Configuration
      additionalProperties: false
      properties:
        extract_file_paths:
          type: boolean
          default: true
          description: Extract file paths
        extract_urls:
          type: boolean
          default: true
          description: Extract URL paths
        extract_s3_paths:
          type: boolean
          default: true
          description: Extract S3 paths
        validate_paths:
          type: boolean
          default: false
          description: Validate path existence
        normalize_paths:
          type: boolean
          default: true
          description: Normalize path formats
        enabled:
          type: boolean
          default: true
          description: Enable this extractor
    patternExtractorConfig:
      type: object
      title: Pattern Extractor Configuration
      additionalProperties: false
      properties:
        predefined_patterns:
          type: array
          items:
            type: string
            enum:
              - email
              - phone
              - url
              - ip
              - ip_address
              - ssn
              - credit_card
              - zip_code
              - file_path
              - version
              - date
          default: []
          description: Use built-in patterns for common data types (e.g., email, phone). Takes precedence over 'patterns' field for matching pattern names
        custom_patterns:
          type: array
          items:
            type: object
            required:
              - name
              - pattern
            additionalProperties: false
            properties:
              name:
                type: string
                description: Pattern name
              pattern:
                type: string
                description: Regex pattern
              description:
                type: string
                description: Pattern description
          default: []
          description: Custom regex patterns
        case_sensitive:
          type: boolean
          default: false
          description: Case-sensitive matching
        return_positions:
          type: boolean
          default: false
          description: Return match positions
        include_context:
          type: boolean
          default: false
          description: Include surrounding context in results
        patterns:
          type: array
          description: Custom regex patterns (deprecated - use 'custom_patterns' instead). Will be merged with 'custom_patterns' if both are specified
          items:
            type: object
            required:
              - name
              - pattern
            properties:
              name:
                type: string
                description: Pattern name
              pattern:
                type: string
                description: Regex pattern
          default: []
          description: Custom patterns to match
        max_matches_per_pattern:
          type: integer
          default: 100
          minimum: 1
          description: Maximum matches per pattern
        deduplicate_matches:
          type: boolean
          default: true
          description: Remove duplicate matches
    statisticsExtractorConfig:
      type: object
      title: Statistics Extractor Configuration
      additionalProperties: false
      properties:
        include_readability:
          type: boolean
          default: true
          description: Calculate readability scores
        include_vocabulary:
          type: boolean
          default: true
          description: Analyze vocabulary
        include_structure:
          type: boolean
          default: true
          description: Analyze text structure
        include_sentiment:
          type: boolean
          default: false
          description: Basic sentiment analysis
        include_sentiment_indicators:
          type: boolean
          default: false
          description: Include detailed sentiment indicators
        include_language:
          type: boolean
          default: true
          description: Detect language
    summaryExtractorConfig:
      type: object
      title: Summary Extractor Configuration
      additionalProperties: false
      properties:
        summary_sentences:
          type: integer
          default: 3
          minimum: 1
          maximum: 10
          description: Number of summary sentences
        algorithm:
          type: string
          enum:
            - textrank
            - lsa
            - luhn
            - lexrank
          default: textrank
          description: Summarization algorithm
        include_key_phrases:
          type: boolean
          default: true
          description: Extract key phrases
        include_statistics:
          type: boolean
          default: true
          description: Include text statistics
        min_sentence_length:
          type: integer
          default: 10
          minimum: 1
          description: Minimum sentence length for summary
        max_sentence_length:
          type: integer
          default: 500
          minimum: 10
          description: Maximum sentence length for summary
    sentimentExtractorConfig:
      type: object
      title: Sentiment Extractor Configuration
      additionalProperties: false
      properties:
        analyze_business_tone:
          type: boolean
          default: false
          description: Analyze business-specific tone
        extract_confidence:
          type: boolean
          default: true
          description: Extract confidence scores
        categories:
          type: array
          items:
            type: string
            enum:
              - positive
              - negative
              - neutral
              - mixed
          default: ["positive", "negative", "neutral"]
          description: Sentiment categories to analyze
    yakeExtractorConfig:
      type: object
      title: YAKE Extractor Configuration
      additionalProperties: false
      properties:
        extractor_type:
          type: string
          const: yake
          description: Extractor type discriminator
        max_keywords:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
          description: Maximum keywords to extract
        language:
          type: string
          default: en
          description: Language for YAKE algorithm
        max_ngram_size:
          type: integer
          default: 3
          minimum: 1
          maximum: 5
          description: Maximum n-gram size for YAKE
        deduplication_threshold:
          type: number
          default: 0.9
          minimum: 0.0
          maximum: 1.0
          description: Deduplication threshold for YAKE
    contentStatisticsExtractorConfig:
      type: object
      title: Content Statistics Extractor Configuration
      additionalProperties: false
      properties:
        include_readability:
          type: boolean
          default: true
          description: Calculate readability scores
        include_vocabulary:
          type: boolean
          default: true
          description: Analyze vocabulary
        include_structure:
          type: boolean
          default: true
          description: Analyze text structure
        include_sentiment_indicators:
          type: boolean
          default: false
          description: Include detailed sentiment indicators
    tableExtractorConfig:
      type: object
      title: Table Extractor Configuration
      additionalProperties: false
      properties:
        output_format:
          type: string
          enum:
            - dict
            - list
            - csv
            - markdown
          default: dict
          description: Output format
        extract_headers:
          type: boolean
          default: true
          description: Extract table headers
        merge_cells:
          type: boolean
          default: true
          description: Handle merged cells
        min_rows:
          type: integer
          default: 2
          minimum: 1
          description: Minimum rows for table
        enabled:
          type: boolean
          default: true
          description: Enable this extractor
    
  embedderConfig:
    title: Embedder Configuration
    required: [type, config]
    properties:
      type:
        type: string
        enum:
          - OllamaEmbedder
          - HuggingFaceEmbedder
      config:
        oneOf:
          - $ref: "#/definitions/embedders/ollamaEmbedderConfig"
          - $ref: "#/definitions/embedders/huggingfaceEmbedderConfig"
  embedders:
    ollamaEmbedderConfig:
      type: object
      title: Ollama Embedder Configuration
      additionalProperties: false
      properties:
        model:
          type: string
          default: nomic-embed-text
          description: Ollama model name
        base_url:
          type: string
          format: uri
          default: http://localhost:11434
          description: Ollama API endpoint (preferred)
        api_base:
          type: string
          format: uri
          description: Alias for base_url (deprecated - use base_url instead). If both are set, base_url takes precedence
        dimension:
          type: integer
          default: 768
          minimum: 128
          maximum: 4096
          description: Embedding dimension
        batch_size:
          type: integer
          default: 16
          minimum: 1
          maximum: 128
          description: Batch processing size
        timeout:
          type: integer
          default: 60
          minimum: 10
          description: Request timeout (seconds)
        auto_pull:
          type: boolean
          default: true
          description: Auto-pull missing models
    huggingfaceEmbedderConfig:
      type: object
      title: HuggingFace Embedder Configuration
      additionalProperties: false
      properties:
        model_name:
          type: string
          default: sentence-transformers/all-MiniLM-L6-v2
          description: HuggingFace model ID
        device:
          type: string
          enum:
            - cpu
            - cuda
            - mps
            - auto
          default: auto
          description: Computation device
        batch_size:
          type: integer
          default: 32
          minimum: 1
          maximum: 256
          description: Batch size
        normalize_embeddings:
          type: boolean
          default: true
          description: L2 normalize embeddings
        show_progress_bar:
          type: boolean
          default: false
          description: Show progress bar
        cache_folder:
          type:
            - string
            - "null"
          default: null
          description: Model cache directory
    sentenceTransformerConfig:
      type: object
      title: Sentence Transformer Configuration
      additionalProperties: false
      properties:
        model_name:
          type: string
          default: sentence-transformers/all-MiniLM-L6-v2
          description: Model name
        device:
          type: string
          default: cpu
          enum:
            - cpu
            - cuda
            - mps
          description: Computation device
  vectorStoreConfig:
    title: Vector Store Configuration
    required: [type, config]
    properties:
      type:
        type: string
        enum:
          - ChromaStore
          - FAISSStore
          - PineconeStore
          - QdrantStore
      config:
        oneOf:
          - $ref: "#/definitions/vectorStores/chromaStoreConfig"
          - $ref: "#/definitions/vectorStores/faissStoreConfig"
          - $ref: "#/definitions/vectorStores/pineconeStoreConfig"
          - $ref: "#/definitions/vectorStores/qdrantStoreConfig"
  vectorStores:
    chromaStoreConfig:
      type: object
      title: Chroma Store Configuration
      additionalProperties: false
      properties:
        collection_name:
          type: string
          default: documents
          pattern: ^[a-zA-Z0-9_-]+$
          description: Collection name
        persist_directory:
          type: string
          default: ./data/chroma_db
          description: Persistence directory
        host:
          type:
            - string
            - "null"
          default: null
          description: Server host
        port:
          type: integer
          default: 8000
          minimum: 1
          maximum: 65535
          description: Server port
        distance_function:
          type: string
          enum:
            - cosine
            - l2
            - ip
          default: cosine
          description: Distance metric
        distance_metric:
          type: string
          enum:
            - cosine
            - l2
            - ip
          default: cosine
          description: Alternative distance metric name
        embedding_dimension:
          type: integer
          default: 768
          minimum: 1
          maximum: 4096
          description: Embedding dimension
        enable_deduplication:
          type: boolean
          default: true
          description: Enable document deduplication
        embedding_function:
          type:
            - string
            - "null"
          default: null
          description: Built-in embedding function
    faissStoreConfig:
      type: object
      title: FAISS Store Configuration
      required:
        - dimension
      additionalProperties: false
      properties:
        dimension:
          type: integer
          minimum: 1
          maximum: 4096
          description: Vector dimension
        index_type:
          type: string
          enum:
            - Flat
            - IVF
            - HNSW
            - LSH
          default: Flat
          description: Index type
        metric:
          type: string
          enum:
            - L2
            - IP
            - Cosine
          default: L2
          description: Distance metric
        nlist:
          type: integer
          default: 100
          minimum: 1
          description: Number of clusters (IVF)
        nprobe:
          type: integer
          default: 10
          minimum: 1
          description: Clusters to search (IVF)
        use_gpu:
          type: boolean
          default: false
          description: Enable GPU acceleration
    pineconeStoreConfig:
      type: object
      title: Pinecone Store Configuration
      required:
        - api_key
        - index_name
        - dimension
      additionalProperties: false
      properties:
        api_key:
          type: string
          description: Pinecone API key
        environment:
          type: string
          default: us-east-1-aws
          description: Pinecone environment
        index_name:
          type: string
          pattern: ^[a-z0-9-]+$
          description: Index name
        dimension:
          type: integer
          minimum: 1
          maximum: 20000
          description: Vector dimension
        metric:
          type: string
          enum:
            - euclidean
            - cosine
            - dotproduct
          default: cosine
          description: Distance metric
        namespace:
          type: string
          default: ""
          description: Namespace for isolation
        replicas:
          type: integer
          default: 1
          minimum: 1
          maximum: 20
          description: Number of replicas
    qdrantStoreConfig:
      type: object
      title: Qdrant Store Configuration
      required:
        - vector_size
      additionalProperties: false
      properties:
        host:
          type: string
          default: localhost
          description: Server host
        port:
          type: integer
          default: 6333
          minimum: 1
          maximum: 65535
          description: Server port
        grpc_port:
          type: integer
          default: 6334
          minimum: 1
          maximum: 65535
          description: gRPC port
        api_key:
          type:
            - string
            - "null"
          default: null
          description: API key
        collection_name:
          type: string
          default: documents
          pattern: ^[a-zA-Z0-9_-]+$
          description: Collection name
        vector_size:
          type: integer
          minimum: 1
          maximum: 65536
          description: Vector dimension
        distance:
          type: string
          enum:
            - Cosine
            - Euclid
            - Dot
          default: Cosine
          description: Distance metric
        on_disk:
          type: boolean
          default: false
          description: Store vectors on disk
  retrievalStrategyConfig:
    title: Retrieval Strategy Configuration
    oneOf:
      - type: object
        title: RetrivalStrategyConfigBasicSimilarity
        required: [type, config]
        properties:
          type:
            type: string
            const: BasicSimilarityStrategy
            description: Retrieval strategy type identifier
          config:
            $ref: "#/definitions/retrievalStrategies/basicSimilarityConfig"
      - required: [type, config]
        properties:
          type:
            type: string
            const: MetadataFilteredStrategy
            description: Retrieval strategy type identifier
          config:
            $ref: "#/definitions/retrievalStrategies/metadataFilteredConfig"
      - required: [type, config]
        properties:
          type:
            type: string
            const: MultiQueryStrategy
            description: Retrieval strategy type identifier
          config:
            $ref: "#/definitions/retrievalStrategies/multiQueryConfig"
      - required: [type, config]
        properties:
          type:
            type: string
            const: RerankedStrategy
            description: Retrieval strategy type identifier
          config:
            $ref: "#/definitions/retrievalStrategies/rerankedConfig"
      - required: [type, config]
        properties:
          type:
            type: string
            const: HybridUniversalStrategy
            description: Retrieval strategy type identifier
          config:
            $ref: "#/definitions/retrievalStrategies/hybridUniversalConfig"
  retrievalStrategies:
    basicSimilarityConfig:
      type: object
      title: Basic Similarity Configuration
      additionalProperties: false
      properties:
        top_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 1000
          description: Number of results
        distance_metric:
          type: string
          default: cosine
          enum:
            - cosine
            - euclidean
            - manhattan
            - dot
          description: Distance metric
        score_threshold:
          type:
            - number
            - "null"
          default: null
          minimum: 0.0
          maximum: 1.0
          description: Minimum similarity score
    metadataFilteredConfig:
      type: object
      title: Metadata Filtered Configuration
      additionalProperties: false
      properties:
        top_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 1000
          description: Number of results
        filters:
          type: object
          default: {}
          description: Metadata filters
          additionalProperties:
            oneOf:
              - type: string
              - type: number
              - type: boolean
              - type: array
                items:
                  oneOf:
                    - type: string
                    - type: number
                    - type: boolean
        filter_mode:
          type: string
          enum:
            - pre
            - post
          default: pre
          description: When to apply filters
        fallback_multiplier:
          type: integer
          default: 3
          minimum: 1
          maximum: 10
          description: Multiplier for post-filtering
    multiQueryConfig:
      type: object
      title: Multi Query Configuration
      additionalProperties: false
      properties:
        num_queries:
          type: integer
          default: 3
          minimum: 1
          maximum: 10
          description: Number of query variations
        top_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 1000
          description: Results per query
        aggregation_method:
          type: string
          default: weighted
          enum:
            - max
            - mean
            - weighted
            - reciprocal_rank
          description: Result aggregation method
        query_weights:
          type:
            - array
            - "null"
          items:
            type: number
            minimum: 0.0
            maximum: 1.0
          default: null
          description: Weights for each query
    rerankedConfig:
      type: object
      title: Reranked Configuration
      additionalProperties: false
      properties:
        initial_k:
          type: integer
          default: 30
          minimum: 10
          maximum: 1000
          description: Initial candidates
        final_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
          description: Final results
        rerank_factors:
          type: object
          additionalProperties: false
          properties:
            similarity_weight:
              type: number
              default: 0.7
              minimum: 0.0
              maximum: 1.0
            recency_weight:
              type: number
              default: 0.1
              minimum: 0.0
              maximum: 1.0
            length_weight:
              type: number
              default: 0.1
              minimum: 0.0
              maximum: 1.0
            metadata_weight:
              type: number
              default: 0.1
              minimum: 0.0
              maximum: 1.0
          description: Reranking factor weights
        normalize_scores:
          type: boolean
          default: true
          description: Normalize scores before combining
    hybridUniversalConfig:
      type: object
      title: Hybrid Universal Configuration
      additionalProperties: false
      properties:
        strategies:
          type: array
          minItems: 2
          maxItems: 5
          items:
            type: object
            required:
              - type
            additionalProperties: false
            properties:
              type:
                type: string
                enum:
                  - BasicSimilarityStrategy
                  - MetadataFilteredStrategy
                  - MultiQueryStrategy
                  - RerankedStrategy
              weight:
                type: number
                default: 1.0
                minimum: 0.0
                maximum: 1.0
              config:
                type: object
          description: Sub-strategies to combine
        combination_method:
          type: string
          default: weighted_average
          enum:
            - weighted_average
            - rank_fusion
            - score_fusion
          description: Combination method
        final_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 1000
          description: Final number of results
 